<!-- 9a62c74c-7e2a-4c19-8ddd-412c09cd3235 5884f3f1-f633-4c70-8d3d-586876ab68e5 -->
# MCP 学习智能体方案

## MCP 工具组合

- `paddleocr` 服务器：调用 `ocrImage`（示例）或相应识别工具，输出结构化文字与版面标签。
- `filesystem` 服务器 (`https://github.com/modelcontextprotocol/servers/tree/main/src/filesystem`)：支持读取/缓存本地学习素材，供后续上传与回溯。
- Notion MCP 工具套件（参考 [Notion MCP Supported Tools](https://developers.notion.com/docs/mcp-supported-tools)）：
- `notion-search`：跨知识库定位教材/错题页，触发上下文补充。
- `notion-fetch`：拉取页面/数据库内容以供文心 4.5 解析。
- `notion-create-pages` / `notion-create-database`：写入错题本、学习计划、复盘笔记。
- `notion-update-page` / `notion-update-database`：同步状态、批注与复盘任务。
- `notion-create-comment`：向师生同步系统反馈。

## 端到端产品流程

1. **输入采集**：用户上传图片或选定 Notion 页；可用 Browser MCP 抓取网页资料。
2. **视觉解析**：PaddleOCR 识别题干、注释、手写步骤，输出结构化 JSON（文本+坐标+版式）。
3. **多格式整理**：

- 生成 Plain Text、Markdown（保持段落/列表）、表格数据、题目切片。
- 附带来源元数据（拍摄时间/页码）。

4. **语义理解与决策（文心 4.5）**：

- 任务分类：批注、解析、整理、学习计划。
- 结合用户画像（来自 Notion 数据库）进行难度评估与反馈优先级。

5. **内容生成**：文心 4.5 输出分步讲解、错因分析、计划日程、复盘问题。
6. **知识管理落地**：

- `notion-create-pages` 新建错题条目或学习总结。
- `notion-update-page` 回写状态、标签、提醒。
- `notion-create-comment` 通知老师/家长或提醒学生。

7. **循环反馈**：监控用户在 Notion 的勾选/评论，触发下一轮学习（通过定时或事件）。

## 智能体框架与技术实现

- **输入/任务路由层**：
- 监听来自聊天、API、Notion Webhook 的请求。
- 基于元数据路由至「OCR→解析」或「Notion→解析」管道。
- **数据管道层**：
- 文件系统缓存 + PaddleOCR 结果持久化。
- 转换器：图像→多格式文本、结构化题目单元。
- **策略编排层**：
- 状态机：`capture → interpret → plan → writeback`。
- 规则 + 文心 4.5 提示模板：根据任务类型加载不同 prompt（批注、计划、教材整理）。
- 个性化因子：Notion 数据库中 `competencyLevel`, `learningGoal`, `preferredStyle`。
- **输出集成层**：
- Notion MCP 写入页面、数据库、评论。
- 可选 Browser MCP 发布到 LMS 或生成分享链接。
- **监控与评估**：
- 记录每次推理耗时、准确率、用户反馈（Notion 属性）。
- 设定重试/告警策略（OCR 信心低、Notion API 速率超过 30 rpm）。

## 实施里程碑

1. **MCP 通道打通**：配置 PaddleOCR、filesystem、Notion MCP，完成凭证与速率保护。
2. **数据结构定义**：设计错题本、学习计划 Notion 数据库（字段：题目、知识点、掌握度、复盘日期、资源链接）。
3. **OCR→文本转换 MVP**：上传单页作业→PaddleOCR→多格式文本→文心 4.5 生成讲解。
4. **Notion 写回**：将讲解/计划写入 Notion 页面并附带评论通知。
5. **策略引擎拓展**：加入个性化提示、自动计划排期、复盘提醒。
6. **产品迭代**：收集用户反馈，优化 prompt、题目切片逻辑、Notion 模板与多模态输出。

### To-dos

- [ ] 配置 PaddleOCR/Filesystem/Notion MCP
- [ ] 设计错题与计划数据库结构
- [ ] 实现 OCR→多格式文本转换
- [ ] 创建写回与评论流程
- [ ] 实现任务路由与提示模板
- [ ] 收集反馈并迭代策略